# Компилятор MiniLang

## Описание проекта

MiniLang - это учебный императивный язык программирования с компилятором, генерирующим код для RISC-V архитектуры. Проект разработан в рамках курса "Разработка компиляторов".

## Возможности языка

### Типы данных
- `int` - целые числа со знаком
- `string` - строки (ASCII символы 32-127)

### Операторы
- Объявление переменных с опциональной инициализацией
- Присваивание
- Условный оператор `if` с опциональным `else`
- Цикл `while`
- Блоки (составные операторы) `{ ... }`
- Вывод значений `print(expression)`

### Выражения
- Арифметические операции: `+`, `-`, `*`, `/`
- Операции сравнения: `==`, `!=`, `<`, `>`, `<=`, `>=`
- Логические операции: `and`, `or`, `not`
- Унарный минус: `-expression`

### Комментарии
- Однострочные: `// комментарий`
- Многострочные: `/* комментарий */`

## Структура проекта

```
minilang/
├── lexer.l          # Лексический анализатор (Flex)
├── parser.y         # Синтаксический анализатор (Bison)
├── ast.h            # Определение структур AST
├── ast.c            # Реализация функций AST
├── codegen.h        # Заголовок генератора кода
├── codegen.c        # Генератор кода RISC-V
├── main.c           # Главный файл компилятора
├── Makefile         # Файл сборки
├── examples.ml      # Примеры программ
└── README.md        # Этот файл

После сборки:
├── minilang         # Исполняемый файл компилятора
├── lex.yy.c         # Сгенерированный лексер
├── parser.tab.c     # Сгенерированный парсер
└── parser.tab.h     # Заголовки парсера
```

## Сборка проекта

### Требования
- GCC компилятор
- Flex (лексический анализатор)
- Bison (генератор парсеров)
- Make

### Установка зависимостей

Ubuntu/Debian:
```bash
sudo apt-get install build-essential flex bison
```

macOS:
```bash
brew install flex bison
```

### Компиляция
```bash
make
```

### Очистка
```bash
make clean
```

## Использование компилятора

### Базовое использование
```bash
./minilang program.ml
```

### Опции командной строки
- `-o <файл>` - указать выходной файл (по умолчанию: output.s)
- `-ast` - вывести AST в текстовом виде
- `-dot <файл>` - сохранить AST в формате GraphViz DOT
- `-h` - показать справку

### Примеры использования

1. Компиляция с выводом AST:
```bash
./minilang -ast examples.ml
```

2. Компиляция с визуализацией AST:
```bash
./minilang -dot ast.dot examples.ml
dot -Tpng ast.dot -o ast.png
```

3. Компиляция в конкретный файл:
```bash
./minilang -o myprogram.s examples.ml
```

## Примеры программ

### Пример 1: Простая арифметика
```c
int x = 10;
int y = 20;
int z = x + y;
print(z);
```

### Пример 2: Условный оператор
```c
int a = 5;
if (a > 3) {
    print(1);
} else {
    print(0);
}
```

### Пример 3: Цикл
```c
int i = 0;
while (i < 5) {
    print(i);
    i = i + 1;
}
```

### Пример 4: Факториал
```c
int n = 5;
int factorial = 1;
int counter = 1;

while (counter <= n) {
    factorial = factorial * counter;
    counter = counter + 1;
}
print(factorial);  // Выведет 120
```

## Запуск сгенерированного кода

Для запуска сгенерированного ассемблерного кода используйте эмулятор RISC-V:
https://github.com/asurkis/risc-emulator

## Тестирование

Создать тестовые файлы и запустить тесты:
```bash
make test-files
make test
```

## Архитектура компилятора

### Этапы компиляции

1. **Лексический анализ** (lexer.l)
   - Разбивает исходный код на токены
   - Обрабатывает комментарии
   - Отслеживает номера строк

2. **Синтаксический анализ** (parser.y)
   - Строит AST на основе грамматики
   - Проверяет синтаксическую корректность
   - Вызывает семантические действия

3. **Построение AST** (ast.c)
   - Создает древовидную структуру программы
   - Поддерживает визуализацию и печать

4. **Генерация кода** (codegen.c)
   - Обходит AST
   - Генерирует ассемблерный код RISC-V
   - Управляет таблицей символов

### Представление в памяти

Переменные хранятся в стеке относительно frame pointer (fp):
- Каждая переменная занимает 8 байт
- Смещения отрицательные от fp

### Соглашения о вызовах

- `a0` - используется для передачи значений и результатов
- `a7` - номер системного вызова
- `sp` - указатель стека
- `fp` - frame pointer
- `t0-t6` - временные регистры

## Обработка ошибок

Компилятор обрабатывает следующие типы ошибок:
- Лексические ошибки (неизвестные символы)
- Синтаксические ошибки
- Использование необъявленных переменных

## Ограничения

- Поддерживаются только локальные переменные
- Нет поддержки функций
- Нет поддержки массивов
- Строки пока не полностью реализованы
- Нет оптимизаций

## Дальнейшее развитие

Возможные улучшения:
1. Добавление функций и процедур
2. Поддержка массивов
3. Полная поддержка строк
4. Типизация и проверка типов
5. Оптимизация сгенерированного кода
6. Улучшенная обработка ошибок
7. Поддержка вещественных чисел

## Автор

### Карташев Владимир 373440

Проект выполнен в рамках курса "Разработка компиляторов".